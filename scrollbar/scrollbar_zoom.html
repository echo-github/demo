<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>imgae zoom scrollbar</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="js/jquery.mousewheel.js"></script>
<style></style>
</head>

<body>
<div class="page_wrap">
	<h1>image scroll zoom</h1>
	<!-- START gallery -->
	<div class="scroll_zoom_gallery js_scroll_zoom_img">
		<div class="window">
			<div class="stage js_stage"><img src="images/demo_pic_l.jpg" alt="" /></div>
		</div>
		<div class="control">
			<div class="btn_plus js_plus"><a href="javascript:;">放大</a></div>
			<div class="bar js_bar">
				<div class="track js_track">
					<div class="bar_dot js_bar_dot">
						<div></div>
					</div>
				</div>
			</div>
			<div class="btn_minus js_minus"><a href="javascript:;">缩小</a></div>
		</div>
	</div>
	<!-- END gallery --> </div>
	
	
	<script type="text/javascript">
	jQuery(function(){
		
			var IE6 = (window.XMLHttpRequest == undefined) && (ActiveXObject != undefined);
			var IE7 = (typeof document.addEventListener != 'function' && window.XMLHttpRequest && typeof document.querySelector =="undefined") ? true : false;

		
			//init js_scroll_zoom_img
			jQuery('.js_scroll_zoom_img').each(function(index, element) {
				var $root = jQuery(this);
				var $stage = $root.find('.js_stage');
				var $stage_img = $stage.find('img');
				var $btn_plus = $root.find('.js_plus');
				var $btn_minus = $root.find('.js_minus');				
				
				var $bar = $root.find('.js_bar');
				var $track = $root.find('.js_track');
				var $bar_dot = $root.find('.js_bar_dot');
				
				var stage_w = $stage.width();
				var stage_h = $stage.height();
				
				var $win = jQuery(window);
				
				var size_max = 2000;
				var size_min = 500;			
				var track_height = $track.height();
				
				/*
				
				resize_to(pct,_x,_y)
				set_bar_to(pct)
				reset_img()
				
				
				*/
				
				
				
				//START function resize_to(pct,_x,_y)
				var resize_to = function( pct,_x,_y ){
					var x = _x || stage_w/2;
					var y = _y || stage_h/2;
					var tar_size = parseInt( ( size_max - size_min ) * (pct/100) + size_min );
					var cur_img_w = $stage_img.width();
					var cur_img_h = $stage_img.height();
					var cur_img_offset = $stage_img.offset();
					var cur_stage_offset = $stage.offset();
					
					var img_2_stage_ox = cur_stage_offset.left - cur_img_offset.left;
					var img_2_stage_oy = cur_stage_offset.top - cur_img_offset.top;
					
					var a_2_img_ox = img_2_stage_ox + x;
					var a_2_img_oy = img_2_stage_oy + y;
					
					var a_2_img_oxp = a_2_img_ox/cur_img_w;
					var a_2_img_oyp = a_2_img_oy/cur_img_h;
					
					var tar_img_ox = tar_size * a_2_img_oxp;
					var tar_img_oy = tar_size * a_2_img_oyp;
					
					var tar_img_2_stage_ox = tar_img_ox - x;
					var tar_img_2_stage_oy = tar_img_oy - y;
					
					//var tar_img_x = cur_stage_offset.left - tar_img_2_stage_ox;
					//var tar_img_y = cur_stage_offset.top - tar_img_2_stage_oy;
					
					$stage_img.css({
						'width':tar_size,
						'height':tar_size,
						'left':-tar_img_2_stage_ox,
						'top':-tar_img_2_stage_oy
					});
					
				}//END function resize_to(pct,_x,_y)
				
				//START function set_bar_to(pct)
				var set_bar_to = function(pct){
					pct = parseInt(pct);
					pct = pct > 100 ? 100:pct;
					pct = pct < 0 ? 0 :pct;
					var apx = (100 - pct)*track_height/100;
					$bar_dot.css({
						'top':apx+'px'
					})
					$bar_dot.data('pct',pct);
				}//END function set_bar_to(pct)
				
				//START function reset_img()
				var reset_img = function(){
					$stage_img.width(size_min).height(size_min);
					var left = ( stage_w - size_min ) / 2;
					var top = ( stage_h - size_min ) / 2;
					$stage_img.css({
						'left':left,
						'top':top
					})
					set_bar_to(0);
				}//END function reset_img()
				
				
				var bar_dot_moy;
				var bar_dot_start_drag = false;
				
				$bar_dot.on('mousedown',function(e){
					var bar_dot_oy = $bar_dot.offset().top;
					var bar_dot_my = e.pageY;
					bar_dot_moy = bar_dot_my - bar_dot_oy;
					bar_dot_start_drag = true;
					e.preventDefault();
					return false;
				});
		
				$bar.on('mouseup mouseenter',function(e){
					bar_dot_start_drag = false;
				});
				
				$bar.on('mousemove',function(e){
					if( bar_dot_start_drag ){
						var track_oy = $track.offset().top;
						var my = e.pageY;
						var dot_tar_y = my + 0;						
						var dot_tar_offset = parseInt(dot_tar_y) - parseInt(track_oy);
						
						if ( dot_tar_offset >=0 && dot_tar_offset<=track_height ){
							/*
							$bar_dot.css({
								'top':dot_tar_offset
							})
							*/
							var pct = parseInt( dot_tar_offset*100/track_height ) || 0;
							var apct = 100-pct;
							set_bar_to(apct);
							resize_to(apct);
						}
						e.preventDefault();
					}
				});
		
		
				var stage_start_move = false;
				var img_ox,img_oy; 
				
				$stage_img.on('mousedown',function(e) {
					var img_offset = $stage_img.offset();
					img_ox = img_offset.left - e.pageX;
					img_oy = img_offset.top - e.pageY;
					stage_start_move = true;
					e.preventDefault();
				});
				
				$stage.on('mouseup mouseenter',function(){
					stage_start_move = false;
				});
				
				
				$stage.on('mousemove',function(e){
					if( stage_start_move ){
						var stage_offset = $stage.offset();
						
						var tar_img_x = e.pageX + img_ox - stage_offset.left;
						var tar_img_y = e.pageY + img_oy - stage_offset.top;
						
						$stage_img.css({
							'left':tar_img_x,
							'top':tar_img_y
						})
						e.preventDefault();
					}
				});
				
				$btn_plus.on('click',function(){
					var $this_btn = jQuery(this);
					var cur_pct = $bar_dot.data('pct');
					var next_pct = cur_pct+10;
					next_pct = next_pct >100 ?100 :next_pct;
					set_bar_to(next_pct);
					resize_to(next_pct);
				});
				
				$btn_minus.on('click',function(){
				
					var $this_btn = jQuery(this);
					var cur_pct = $bar_dot.data('pct');
					var next_pct = cur_pct-10;
					next_pct = next_pct < 0  ? 0 :next_pct;
					set_bar_to(next_pct);
					resize_to(next_pct);
				});		
				
				
				// mouse wheel init				
				$stage.on('mousewheel',function(e,d){
					var cur_pct = $bar_dot.data('pct');
					var next_pct = cur_pct+d*3;
					next_pct = next_pct >100 ?100 :next_pct;
					next_pct = next_pct <0 ?0 :next_pct;
					set_bar_to(next_pct);
					
					var stage_offset = $stage.offset();
					var mx = e.pageX - stage_offset.left;
					var my = e.pageY - stage_offset.top;
					resize_to(next_pct,mx,my);
					return false;
				});
						
				
		  });
	
	
	})
	
	</script>
</body>
</html>
